
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Función para verificar si el email del usuario es el del administrador.
    function esAdmin() {
      return request.auth.token.email == "berrojalbizjulieta@gmail.com";
    }

    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == userId || esAdmin();
    }

    match /professionalsDetails/{profId} {
      // Cualquiera puede leer un perfil de profesional (para la página pública).
      // Solo el dueño del perfil o un admin puede escribir/actualizar.
      allow read: if true;
      allow write: if request.auth != null && (request.auth.uid == profId || esAdmin());
    }

    match /reviews/{reviewId} {
      allow read: if true;
      // Un usuario puede crear/actualizar su propia reseña.
      allow write: if request.auth != null && request.resource.data.userId == request.auth.uid;
    }
    
    match /jobRequests/{jobId} {
        // Cualquiera puede leer las solicitudes de trabajo.
        allow read: if true;
        // Solo usuarios autenticados pueden crear. Solo el creador o un admin pueden actualizar/borrar.
        allow create: if request.auth != null;
        allow update, delete: if resource.data.clientId == request.auth.uid || esAdmin();
    }

    match /adBanners/{bannerId} {
        allow read: if true;
        allow write, create, delete: if esAdmin();
    }

    // Reglas para la colección 'analytics'
    match /analytics/{docId} {
      // Cualquiera puede escribir (para el contador de visitas anónimo).
      allow write: if true;
      // Solo el admin puede leer los documentos de analíticas.
      allow read: if esAdmin();
    }
  }
}
