
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Permite que cualquiera (autenticado o no) lea los datos de los profesionales y usuarios
    // Esto es necesario para que los perfiles públicos y la información general sean visibles
    match /users/{userId} {
      allow read: if true;
      allow write: if request.auth.uid == userId;
    }

    match /professionalsDetails/{professionalId} {
      allow read: if true;
      allow write: if request.auth.uid == professionalId;
    }

    // Permite que solo los usuarios autenticados puedan crear reseñas.
    // Nadie puede actualizarlas o borrarlas desde el cliente para mantener la integridad.
    match /reviews/{reviewId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if false; // Por seguridad, no permitir editar/borrar reseñas desde el cliente
    }

    // Permite leer las solicitudes de trabajo (jobRequests) a cualquiera.
    // Solo el dueño del post puede crearlo o actualizarlo (ej. para cerrarlo).
    match /jobRequests/{jobId} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update: if request.auth.uid == resource.data.clientId;
    }

    // Permite que cualquiera lea los banners publicitarios.
    match /adBanners/{bannerId} {
      allow read: if true;
      // La escritura de banners se debe manejar desde un panel de admin con privilegios.
      // Por ahora la dejamos cerrada desde el cliente.
      allow write: if false;
    }
  }
}
